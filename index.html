<!DOCTYPE html>
<html lang="zh-TW"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">免費資源網</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 data-translate-key="mainTitle">免費資源網</h1>
        <nav id="navbar-container">
            </nav>
    </header>

    <main>
        <div class="container">
            <div class="resource-item">
                <h2 data-translate-key="previewTitleNetdisk">免費網盤</h2>
                <p data-translate-key="previewDescNetdisk">這裡提供多種免費雲端儲存服務的簡要介紹。</p>
                <a href="pan/wangpan.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleEmail">免費電子郵箱</h2>
                <p data-translate-key="previewDescEmail">提供免費的電子郵件服務，具備便捷管理功能與大容量儲存空間。</p>
                <a href="email/you.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleDomain">免費域名</h2>
                <p data-translate-key="previewDescDomain">獲取免費的域名註冊服務，輕鬆建立您自己的網站。</p>
                <a href="domain/yumian.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleDeals">免費羊毛</h2>
                <p data-translate-key="previewDescDeals">搜羅網路上各種免費活動與優惠，薅羊毛、拿好禮。</p>
                <a href="sleep/yang.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleMovies">免費電影</h2>
                <p data-translate-key="previewDescMovies">免費觀看高清電影，海量資源隨時看，享受視聽盛宴。</p>
                <a href="movie/mov.html" data-translate-key="viewDetails">查看詳情</a>
            </div>
        </div>
    </main>
    
    <footer>
        <h2 data-translate-key="visitorsCountTitle">訪問人數</h2>
        <div class="statcounter"> <a title="Web Analytics" href="https://statcounter.com/" target="_blank">
                <img class="statcounter" src="https://c.statcounter.com/13039053/0/8f2c3505/0/" alt="Web Analytics" data-translate-key="statCounterAlt" referrerPolicy="no-referrer-when-downgrade" style="width: 150px; height: auto; border:0;">
            </a>
        </div>
    </footer>

    <script>
        // 翻譯字典 (繁體中文, 英文)
        const translations = {
            'zh-TW': { // 繁體中文
                pageTitle: "免費資源網",
                mainTitle: "免費資源網",
                navIndex: "首頁",
                navFreeDeals: "免費羊毛",
                navFreeNetdisk: "免費網盤",
                navFreeEmail: "免費電子郵箱",
                navFreeDomain: "免費域名",
                navFreeMovies: "免費電影",
                navNotes: "隨記",
                navTools: "小工具",
                previewTitleNetdisk: "免費網盤",
                previewDescNetdisk: "這裡提供多種免費雲端儲存服務的簡要介紹。",
                previewTitleEmail: "免費電子郵箱",
                previewDescEmail: "提供免費的電子郵件服務，具備便捷管理功能與大容量儲存空間。",
                previewTitleDomain: "免費域名",
                previewDescDomain: "獲取免費的域名註冊服務，輕鬆建立您自己的網站。",
                previewTitleDeals: "免費羊毛",
                previewDescDeals: "搜羅網路上各種免費活動與優惠，薅羊毛、拿好禮。",
                previewTitleMovies: "免費電影",
                previewDescMovies: "免費觀看高清電影，海量資源隨時看，享受視聽盛宴。",
                viewDetails: "查看詳情",
                visitorsCountTitle: "訪問人數",
                statCounterAlt: "網站分析"
            },
            'en': { // 英文
                pageTitle: "Free Resources Network",
                mainTitle: "Free Resources Network",
                navIndex: "Home",
                navFreeDeals: "Freebies & Deals",
                navFreeNetdisk: "Free Cloud Storage",
                navFreeEmail: "Free Email",
                navFreeDomain: "Free Domain",
                navFreeMovies: "Free Movies",
                navNotes: "Notes",
                navTools: "Tools",
                previewTitleNetdisk: "Free Cloud Storage",
                previewDescNetdisk: "A brief introduction to various free cloud storage services.",
                previewTitleEmail: "Free Email",
                previewDescEmail: "Provides free email services with convenient management and large storage capacity.",
                previewTitleDomain: "Free Domain",
                previewDescDomain: "Get free domain registration services and easily build your own website.",
                previewTitleDeals: "Freebies & Deals",
                previewDescDeals: "Collect various free online activities and discounts. Grab good deals.",
                previewTitleMovies: "Free Movies",
                previewDescMovies: "Watch HD movies for free, with a vast library available anytime. Enjoy the audiovisual feast.",
                viewDetails: "View Details",
                visitorsCountTitle: "Visitor Count",
                statCounterAlt: "Web Analytics"
            }
        };

        /**
         * 應用翻譯到指定節點
         * @param {Node} node - 要翻譯的 DOM 節點
         * @param {string} langKey - 語言金鑰 (例如 'zh-TW', 'en')
         */
        function applyTranslationsToNode(node, langKey) {
            const langTranslations = translations[langKey];
            if (!langTranslations) {
                console.warn(`未找到語言 ${langKey} 的翻譯。`);
                return;
            }

            // 翻譯頁面標題
            if (node === document.documentElement) { // 確保只在翻譯整個文檔時執行一次
                const pageTitleElement = document.querySelector('title[data-translate-key="pageTitle"]');
                if (pageTitleElement && langTranslations.pageTitle) {
                    document.title = langTranslations.pageTitle;
                }
            }
            
            // 遍歷所有帶有 data-translate-key 屬性的元素
            const elementsToTranslate = node.querySelectorAll('[data-translate-key]');
            elementsToTranslate.forEach(element => {
                const key = element.getAttribute('data-translate-key');
                // 跳過已經處理過的 <title>
                if (element.tagName === 'TITLE' && key === 'pageTitle') {
                    return;
                }
                if (langTranslations[key]) {
                    if (element.tagName === 'IMG' && key.toLowerCase().includes('alt')) {
                         element.alt = langTranslations[key];
                    } else {
                        element.textContent = langTranslations[key];
                    }
                } else {
                    console.warn(`在語言 '${langKey}' 中找不到鍵 '${key}' 的翻譯。`);
                }
            });
        }

        /**
         * 偵測瀏覽器語言並返回最佳可用語言金鑰
         * @returns {string} 語言金鑰
         */
        function getBestAvailableLanguage() {
            const browserLangFull = navigator.language || navigator.userLanguage; 
            const browserLangBase = browserLangFull.split('-')[0]; 

            if (translations[browserLangFull]) return browserLangFull;
            if (translations[browserLangBase]) return browserLangBase;
            if (browserLangBase === 'zh' && translations['zh-TW']) return 'zh-TW';
            if (translations['en']) return 'en'; // 預設回退到英文
            return Object.keys(translations)[0] || 'en'; // 最後回退
        }

        /**
         * 設定頁面語言
         */
        function setPageLanguage() {
            const langKey = getBestAvailableLanguage();
            document.documentElement.lang = langKey; 
            applyTranslationsToNode(document.documentElement, langKey); 
            window.currentLanguage = langKey; // 儲存當前語言供導覽列使用
            console.log(`[DEBUG] 頁面語言已設定為: ${langKey}`);
        }

        // DOM 載入完成後執行
        document.addEventListener('DOMContentLoaded', () => {
            setPageLanguage(); 

            // 載入導覽列
            fetch('./navbar.html') // 假設 navbar.html 在同一目錄
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`導覽列檔案載入失敗，狀態： ${response.status}`);
                    }
                    return response.text(); 
                })
                .then(data => {
                    const navbarContainer = document.getElementById('navbar-container');
                    if (navbarContainer) {
                        // console.log('[DEBUG] 原始 navbar.html 內容:', data);
                        navbarContainer.innerHTML = data; // 將 navbar.html 的內容注入
                        
                        if (window.currentLanguage) {
                            // console.log('[DEBUG] 正在使用語言翻譯導覽列:', window.currentLanguage);
                            applyTranslationsToNode(navbarContainer, window.currentLanguage);
                            // console.log('[DEBUG] 翻譯後的 navbarContainer innerHTML:', navbarContainer.innerHTML);
                        } else {
                            console.warn('[DEBUG] window.currentLanguage 未設定，無法翻譯導覽列。');
                        }
                    } else {
                        console.error("ID 為 'navbar-container' 的元素找不到。");
                    }
                })
                .catch(error => {
                    console.error('載入導覽列時發生錯誤:', error);
                    const navbarContainer = document.getElementById('navbar-container');
                    if (navbarContainer) { // 確保元素存在才操作
                        navbarContainer.innerHTML = `<p style="color: red;">導覽列載入失敗，請稍後再試。</p>`;
                    }
                });

            // 隨機打開新頁面功能 (暫時註解掉以專注於樣式和翻譯問題)
            // setTimeout(randomOpenNewPage, 100); 
        });

        /**
         * 從 'tun.txt' 載入並隨機打開 URL (此函數保持不變)
         */
        function randomOpenNewPage() {
            fetch('tun.txt')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`tun.txt 檔案載入失敗，狀態碼：${response.status}`);
                    }
                    return response.text();
                })
                .then(data => {
                    const urls = data.split('\n').map(url => url.trim()).filter(url => url !== '');
                    if (urls.length > 0) {
                        const randomUrl = urls[Math.floor(Math.random() * urls.length)];
                        const popupWidth = 400;
                        const popupHeight = 300;
                        const topPos = (window.innerHeight - popupHeight) / 2;
                        const leftPos = (window.innerWidth - popupWidth) / 2;
                        try {
                            const newWindow = window.open(randomUrl, '_blank', `width=${popupWidth},height=${popupHeight},top=${topPos},left=${leftPos},resizable=yes,scrollbars=yes`);
                            if (newWindow) {
                                window.focus(); 
                            } else {
                                console.warn('彈出視窗可能已被瀏覽器攔截。');
                            }
                        } catch (e) {
                            console.error('打開新視窗時發生錯誤:', e);
                        }
                    } else {
                        console.warn('tun.txt 檔案中沒有可用的URL。');
                    }
                })
                .catch(error => {
                    console.error('從 tun.txt 載入 URL 時發生錯誤:', error);
                });
        }
    </script>
</body>
</html>
