<!DOCTYPE html>
<html lang="zh-TW"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">免費資源網</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 data-translate-key="mainTitle">免費資源網</h1>
        <nav id="navbar-container">
            </nav>
    </header>

    <main>
        <div class="container">
            <div class="resource-item">
                <h2 data-translate-key="previewTitleNetdisk">免費網盤</h2>
                <p data-translate-key="previewDescNetdisk">這裡提供多種免費雲端儲存服務的簡要介紹。</p>
                <a href="pan/wangpan.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleEmail">免費電子郵箱</h2>
                <p data-translate-key="previewDescEmail">提供免費的電子郵件服務，具備便捷管理功能與大容量儲存空間。</p>
                <a href="email/you.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleDomain">免費域名</h2>
                <p data-translate-key="previewDescDomain">獲取免費的域名註冊服務，輕鬆建立您自己的網站。</p>
                <a href="domain/yumian.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleDeals">免費羊毛</h2>
                <p data-translate-key="previewDescDeals">搜羅網路上各種免費活動與優惠，薅羊毛、拿好禮。</p>
                <a href="sleep/yang.html" data-translate-key="viewDetails">查看詳情</a>
            </div>

            <div class="resource-item">
                <h2 data-translate-key="previewTitleMovies">免費電影</h2>
                <p data-translate-key="previewDescMovies">免費觀看高清電影，海量資源隨時看，享受視聽盛宴。</p>
                <a href="movie/mov.html" data-translate-key="viewDetails">查看詳情</a>
            </div>
        </div>
    </main>
    
    <footer>
        <h2 data-translate-key="visitorsCountTitle">訪問人數</h2>
        <div id="visitorStats">
             <p data-translate-key="localPageLoadsText">此瀏覽器頁面載入次數：<span id="pageLoadCountSpan">0</span></p>
            <p style="font-size: 0.8em; margin-top: 5px; color: #777;" data-translate-key="counterDisclaimer">（此計數器僅記錄您在此瀏覽器上的載入次數）</p>
        </div>
    </footer>

    <script>
        // 翻譯字典 (繁體中文, 英文)
        const translations = {
            'zh-TW': { // 繁體中文
                pageTitle: "免費資源網",
                mainTitle: "免費資源網",
                navIndex: "首頁",
                navFreeDeals: "免費羊毛",
                navFreeNetdisk: "免費網盤",
                navFreeEmail: "免費電子郵箱",
                navFreeDomain: "免費域名",
                navFreeMovies: "免費電影",
                navNotes: "隨記",
                navTools: "小工具",
                previewTitleNetdisk: "免費網盤",
                previewDescNetdisk: "這裡提供多種免費雲端儲存服務的簡要介紹。",
                previewTitleEmail: "免費電子郵箱",
                previewDescEmail: "提供免費的電子郵件服務，具備便捷管理功能與大容量儲存空間。",
                previewTitleDomain: "免費域名",
                previewDescDomain: "獲取免費的域名註冊服務，輕鬆建立您自己的網站。",
                previewTitleDeals: "免費羊毛",
                previewDescDeals: "搜羅網路上各種免費活動與優惠，薅羊毛、拿好禮。",
                previewTitleMovies: "免費電影",
                previewDescMovies: "免費觀看高清電影，海量資源隨時看，享受視聽盛宴。",
                viewDetails: "查看詳情",
                visitorsCountTitle: "訪問人數", // 已存在
                localPageLoadsText: "此瀏覽器頁面載入次數：", // 新增
                counterDisclaimer: "（此計數器僅記錄您在此瀏覽器上的載入次數）", // 新增
                statCounterAlt: "網站分析" // 保留，雖然圖片已移除，但以防萬一
            },
            'en': { // 英文
                pageTitle: "Free Resources Network",
                mainTitle: "Free Resources Network",
                navIndex: "Home",
                navFreeDeals: "Freebies & Deals",
                navFreeNetdisk: "Free Cloud Storage",
                navFreeEmail: "Free Email",
                navFreeDomain: "Free Domain",
                navFreeMovies: "Free Movies",
                navNotes: "Notes",
                navTools: "Tools",
                previewTitleNetdisk: "Free Cloud Storage",
                previewDescNetdisk: "A brief introduction to various free cloud storage services.",
                previewTitleEmail: "Free Email",
                previewDescEmail: "Provides free email services with convenient management and large storage capacity.",
                previewTitleDomain: "Free Domain",
                previewDescDomain: "Get free domain registration services and easily build your own website.",
                previewTitleDeals: "Freebies & Deals",
                previewDescDeals: "Collect various free online activities and discounts. Grab good deals.",
                previewTitleMovies: "Free Movies",
                previewDescMovies: "Watch HD movies for free, with a vast library available anytime. Enjoy the audiovisual feast.",
                viewDetails: "View Details",
                visitorsCountTitle: "Visitor Count", // Already exists
                localPageLoadsText: "Page loads (this browser): ", // New
                counterDisclaimer: "(This counter only tracks your loads in this browser)", // New
                statCounterAlt: "Web Analytics" // Kept just in case, though image removed
            }
        };

        function applyTranslationsToNode(node, langKey) {
            const langTranslations = translations[langKey];
            if (!langTranslations) {
                console.warn(`未找到語言 ${langKey} 的翻譯。`);
                return;
            }
            if (node === document.documentElement) {
                const pageTitleElement = document.querySelector('title[data-translate-key="pageTitle"]');
                if (pageTitleElement && langTranslations.pageTitle) {
                    document.title = langTranslations.pageTitle;
                }
            }
            const elementsToTranslate = node.querySelectorAll('[data-translate-key]');
            elementsToTranslate.forEach(element => {
                const key = element.getAttribute('data-translate-key');
                if (element.tagName === 'TITLE' && key === 'pageTitle') return;
                if (langTranslations[key]) {
                    if (element.tagName === 'IMG' && key.toLowerCase().includes('alt')) {
                         element.alt = langTranslations[key];
                    } else {
                        element.textContent = langTranslations[key];
                    }
                } else {
                    console.warn(`在語言 '${langKey}' 中找不到鍵 '${key}' 的翻譯。`);
                }
            });
        }

        function getBestAvailableLanguage() {
            const browserLangFull = navigator.language || navigator.userLanguage; 
            const browserLangBase = browserLangFull.split('-')[0]; 
            if (translations[browserLangFull]) return browserLangFull;
            if (translations[browserLangBase]) return browserLangBase;
            if (browserLangBase === 'zh' && translations['zh-TW']) return 'zh-TW';
            if (translations['en']) return 'en';
            return Object.keys(translations)[0] || 'en';
        }

        function setPageLanguage() {
            const langKey = getBestAvailableLanguage();
            document.documentElement.lang = langKey; 
            applyTranslationsToNode(document.documentElement, langKey); 
            window.currentLanguage = langKey; 
            console.log(`[DEBUG] 頁面語言已設定為: ${langKey}`);
        }

        /**
         * 更新並顯示本地 localStorage 頁面載入計數器
         */
        function updateLocalPageLoadCounter() {
            const countKey = 'myResourceSitePageLoadCount'; // 使用唯一的 localStorage 鍵名
            let count = parseInt(localStorage.getItem(countKey)) || 0;
            count++; // 為本次訪問增加計數
            localStorage.setItem(countKey, count);

            const countSpan = document.getElementById('pageLoadCountSpan');
            if (countSpan) {
                countSpan.textContent = count;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            setPageLanguage(); // 這會設定 window.currentLanguage 並應用初始翻譯
            updateLocalPageLoadCounter(); // 更新並顯示本地計數器

            fetch('./navbar.html')
                .then(response => {
                    if (!response.ok) throw new Error(`導覽列檔案載入失敗，狀態： ${response.status}`);
                    return response.text(); 
                })
                .then(data => {
                    const navbarContainer = document.getElementById('navbar-container');
                    if (navbarContainer) {
                        navbarContainer.innerHTML = data;
                        if (window.currentLanguage) {
                            applyTranslationsToNode(navbarContainer, window.currentLanguage);
                        }
                    } else {
                        console.error("ID 為 'navbar-container' 的元素找不到。");
                    }
                })
                .catch(error => {
                    console.error('載入導覽列時發生錯誤:', error);
                    const navbarContainer = document.getElementById('navbar-container');
                    if (navbarContainer) {
                        navbarContainer.innerHTML = `<p style="color: red;">導覽列載入失敗，請稍後再試。</p>`;
                    }
                });

            // setTimeout(randomOpenNewPage, 100); // 隨機打開新頁面功能 (如有需要可取消註解)
        });

        function randomOpenNewPage() {
            fetch('tun.txt')
                .then(response => {
                    if (!response.ok) throw new Error(`tun.txt 檔案載入失敗，狀態碼：${response.status}`);
                    return response.text();
                })
                .then(data => {
                    const urls = data.split('\n').map(url => url.trim()).filter(url => url !== '');
                    if (urls.length > 0) {
                        const randomUrl = urls[Math.floor(Math.random() * urls.length)];
                        const popupWidth = 400; const popupHeight = 300;
                        const topPos = (window.innerHeight - popupHeight) / 2; const leftPos = (window.innerWidth - popupWidth) / 2;
                        try {
                            const newWindow = window.open(randomUrl, '_blank', `width=${popupWidth},height=${popupHeight},top=${topPos},left=${leftPos},resizable=yes,scrollbars=yes`);
                            if (!newWindow) console.warn('彈出視窗可能已被瀏覽器攔截。');
                            else window.focus(); 
                        } catch (e) { console.error('打開新視窗時發生錯誤:', e); }
                    } else { console.warn('tun.txt 檔案中沒有可用的URL。'); }
                })
                .catch(error => console.error('從 tun.txt 載入 URL 時發生錯誤:', error));
        }
    </script>
</body>
</html>
